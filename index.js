var myip = "[2a01:e35:139f:b290:78f6:ea7c:db6a:8673]";
var t = {
  'o/': 'ðŸ‘‹',
  '</3': 'ðŸ’”',
  '<3': 'ðŸ’—',
  '8-D': 'ðŸ˜',
  '8D': 'ðŸ˜',
  ':-D': 'ðŸ˜',
  '=-3': 'ðŸ˜',
  '=-D': 'ðŸ˜',
  '=3': 'ðŸ˜',
  '=D': 'ðŸ˜',
  'B^D': 'ðŸ˜',
  'X-D': 'ðŸ˜',
  'XD': 'ðŸ˜',
  'x-D': 'ðŸ˜',
  'xD': 'ðŸ˜',
  ':\')': 'ðŸ˜‚',
  ':\'-)': 'ðŸ˜‚',
  ':-))': 'ðŸ˜ƒ',
  '8)': 'ðŸ˜„',
  ':)': 'ðŸ˜„',
  ':-)': 'ðŸ˜„',
  ':3': 'ðŸ˜„',
  ':D': 'ðŸ˜„',
  ':]': 'ðŸ˜„',
  ':^)': 'ðŸ˜„',
  ':c)': 'ðŸ˜„',
  ':o)': 'ðŸ˜„',
  ':}': 'ðŸ˜„',
  ':ã£)': 'ðŸ˜„',
  '=)': 'ðŸ˜„',
  '=]': 'ðŸ˜„',
  '0:)': 'ðŸ˜‡',
  '0:-)': 'ðŸ˜‡',
  '0:-3': 'ðŸ˜‡',
  '0:3': 'ðŸ˜‡',
  '0;^)': 'ðŸ˜‡',
  'O:-)': 'ðŸ˜‡',
  '3:)': 'ðŸ˜ˆ',
  '3:-)': 'ðŸ˜ˆ',
  '}:)': 'ðŸ˜ˆ',
  '}:-)': 'ðŸ˜ˆ',
  '*)': 'ðŸ˜‰',
  '*-)': 'ðŸ˜‰',
  ':-,': 'ðŸ˜‰',
  ';)': 'ðŸ˜‰',
  ';-)': 'ðŸ˜‰',
  ';-]': 'ðŸ˜‰',
  ';D': 'ðŸ˜‰',
  ';]': 'ðŸ˜‰',
  ';^)': 'ðŸ˜‰',
  ':-|': 'ðŸ˜',
  ':|': 'ðŸ˜',
  ':(': 'ðŸ˜’',
  ':-(': 'ðŸ˜’',
  ':-<': 'ðŸ˜’',
  ':-[': 'ðŸ˜’',
  ':-c': 'ðŸ˜’',
  ':<': 'ðŸ˜’',
  ':[': 'ðŸ˜’',
  ':c': 'ðŸ˜’',
  ':{': 'ðŸ˜’',
  ':ã£C': 'ðŸ˜’',
  '%)': 'ðŸ˜–',
  '%-)': 'ðŸ˜–',
  ':-P': 'ðŸ˜œ',
  ':-b': 'ðŸ˜œ',
  ':-p': 'ðŸ˜œ',
  ':-Ãž': 'ðŸ˜œ',
  ':-Ã¾': 'ðŸ˜œ',
  ':P': 'ðŸ˜œ',
  ':b': 'ðŸ˜œ',
  ':p': 'ðŸ˜œ',
  ':Ãž': 'ðŸ˜œ',
  ':Ã¾': 'ðŸ˜œ',
  ';(': 'ðŸ˜œ',
  '=p': 'ðŸ˜œ',
  'X-P': 'ðŸ˜œ',
  'XP': 'ðŸ˜œ',
  'd:': 'ðŸ˜œ',
  'x-p': 'ðŸ˜œ',
  'xp': 'ðŸ˜œ',
  ':-||': 'ðŸ˜ ',
  ':@': 'ðŸ˜ ',
  ':-.': 'ðŸ˜¡',
  ':-/': 'ðŸ˜¡',
  ':/': 'ðŸ˜¡',
  ':L': 'ðŸ˜¡',
  ':S': 'ðŸ˜¡',
  ':\\': 'ðŸ˜¡',
  '=/': 'ðŸ˜¡',
  '=L': 'ðŸ˜¡',
  '=\\': 'ðŸ˜¡',
  ':\'(': 'ðŸ˜¢',
  ':\'-(': 'ðŸ˜¢',
  '^5': 'ðŸ˜¤',
  '^<_<': 'ðŸ˜¤',
  'o/\\o': 'ðŸ˜¤',
  '|-O': 'ðŸ˜«',
  '|;-)': 'ðŸ˜«',
  ':###..': 'ðŸ˜°',
  ':-###..': 'ðŸ˜°',
  'D-\':': 'ðŸ˜±',
  'D8': 'ðŸ˜±',
  'D:': 'ðŸ˜±',
  'D:<': 'ðŸ˜±',
  'D;': 'ðŸ˜±',
  'D=': 'ðŸ˜±',
  'DX': 'ðŸ˜±',
  'v.v': 'ðŸ˜±',
  '8-0': 'ðŸ˜²',
  ':-O': 'ðŸ˜²',
  ':-o': 'ðŸ˜²',
  ':O': 'ðŸ˜²',
  ':o': 'ðŸ˜²',
  'O-O': 'ðŸ˜²',
  'O_O': 'ðŸ˜²',
  'O_o': 'ðŸ˜²',
  'o-o': 'ðŸ˜²',
  'o_O': 'ðŸ˜²',
  'o_o': 'ðŸ˜²',
  ':$': 'ðŸ˜³',
  '#-)': 'ðŸ˜µ',
  ':#': 'ðŸ˜¶',
  ':&': 'ðŸ˜¶',
  ':-#': 'ðŸ˜¶',
  ':-&': 'ðŸ˜¶',
  ':-X': 'ðŸ˜¶',
  ':X': 'ðŸ˜¶',
  ':-J': 'ðŸ˜¼',
  ':*': 'ðŸ˜½',
  ':^*': 'ðŸ˜½',
  'à² _à² ': 'ðŸ™…',
  '*\\0/*': 'ðŸ™†',
  '\\o/': 'ðŸ™†',
  ':>': 'ðŸ˜„',
  '>.<': 'ðŸ˜¡',
  '>:(': 'ðŸ˜ ',
  '>:)': 'ðŸ˜ˆ',
  '>:-)': 'ðŸ˜ˆ',
  '>:/': 'ðŸ˜¡',
  '>:O': 'ðŸ˜²',
  '>:P': 'ðŸ˜œ',
  '>:[': 'ðŸ˜’',
  '>:\\': 'ðŸ˜¡',
  '>;)': 'ðŸ˜ˆ',
  '>_>^': 'ðŸ˜¤'
};


var WebSocket = require('ws');
var express = require('express');
var http = require('http');
var anchorme = require("anchorme").default;
var emoji = require('node-emoji');

var app = express();

app.use(express.static(__dirname + "/public"));
app.set('port', process.env.PORT || 3000;);
var options = {};
var server = http.createServer(options, app);
server.listen(app.get("port"));

var wss = new WebSocket.Server({ port: 8081 });
wss.on('connection', function connection(ws) {
  ws.on('message', function incoming(data) {
    console.log(data);
    data = anchorme(data, { attributes: [{ name: "target", value: "_blank" }] });
    for (key in t) {
      while (data.indexOf(key) !== -1)
        data = data.replace(key, t[key]);
    }
    // forward to everybody !!
    wss.clients.forEach(function each(client) {
      if (client.readyState === WebSocket.OPEN) {
        client.send(data);
      }
    });
  });
});

console.log("Let's chat !");
